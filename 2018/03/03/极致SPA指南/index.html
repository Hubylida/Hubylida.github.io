<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="前端/安全">
    

    <!--Author-->
    
        <meta name="author" content="Yuan">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="极致SPA指南"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="前端/安全" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Yuan"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>极致SPA指南 - Yuan</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/LHHYuan/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
   <link href="/LHHYuan/favicon.ico" rel="icon" type="image/x-ico">
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/LHHYuan/">回到首页</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/LHHYuan/categories/Study">
                            
                                Study
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/LHHYuan/categories/随笔">
                            
                                随笔
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/LHHYuan/categories/leetcode">
                            
                                leetcode
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/LHHYuan/Source">
                            
                                Source
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/Hubylida">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://ou2r9nim8.bkt.clouddn.com/1.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>极致SPA指南</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            2018-03-03
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        

<a href="/LHHYuan/categories/Study/">Study</a>

                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p><a href="https://zhuanlan.zhihu.com/p/33687711" target="_blank" rel="external">极致 SPA 指南</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前端框架时代，为开发体验、效率与页面性能带来，非常大的革命。大家纷纷拿起一系列打包工具(webpack/parcel etc.)，配合一系列加载器快速搭建起一个 SPA 页面。</p>
<p>SPA 应用带来的好处非常明显；</p>
<ul>
<li><p>提升页面切换体验</p>
</li>
<li><p>降低切换时间</p>
</li>
<li><p>易于部署&amp;前后端分离</p>
</li>
</ul>
<p>但是也带来一系列性能问题：</p>
<ul>
<li><p>初始加载脚本较大</p>
</li>
<li><p>首屏空白时间较长</p>
</li>
<li><p>页面返回时，数据被动重新拉取</p>
</li>
</ul>
<p>这些问题是使用 SPA 模式不可避免的， 通过了解 SPA 加载运行过程，可以逐渐看清楚引起性能问题的根本原因，通过精细化应用加载，来解决这些问题。</p>
<h2 id="SPA-之殇"><a href="#SPA-之殇" class="headerlink" title="SPA 之殇"></a>SPA 之殇</h2><h3 id="愈发发福"><a href="#愈发发福" class="headerlink" title="愈发发福"></a>愈发发福</h3><p>比起一般的简单页面，SPA 最大的问题，就是在初始化之时引入大量框架方案脚本，这导致脚本体积随着项目发展体积愈发增大。</p>
<h3 id="不仅仅是体积"><a href="#不仅仅是体积" class="headerlink" title="不仅仅是体积"></a>不仅仅是体积</h3><p>很多人会关注脚本的加载体积，通过一系列方案来提升缓存命中率，减少脚本请求次数。在网络环境较差的移动端，尽量减少请求时间意义很大。</p>
<p>但这不是银弹，移动设备对脚本的解析、编译、执行性能较差（脚本加载参考《图说舌尖上的脚本》），即便可以完全利用缓存，执行时间也是性能一大瓶颈。</p>
<h3 id="Keep-SPA-Fit"><a href="#Keep-SPA-Fit" class="headerlink" title="Keep SPA Fit"></a>Keep SPA Fit</h3><p>性能优化原则：贫则独善其身，富则兼济天下。</p>
<h2 id="如何维护一个大型-SPA？"><a href="#如何维护一个大型-SPA？" class="headerlink" title="如何维护一个大型 SPA？"></a>如何维护一个大型 SPA？</h2><p>随着项目不断发展，页面不断增加，源源不断的第三方组件&amp;工具库加入到Bundle里面，良好的 SPA 架构可以保证大型 SPA 项目依旧保持极致的性能与体验。下面介绍一个优秀性能&amp;体验 SPA 具备的特性：</p>
<h2 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h2><h3 id="1-快速启动-——-极大提升加载速度（important）"><a href="#1-快速启动-——-极大提升加载速度（important）" class="headerlink" title="1. 快速启动 —— 极大提升加载速度（important）"></a>1. 快速启动 —— 极大提升加载速度（important）</h3><p>快速启动应用，并行发起 Bundle 加载&amp;拉取初始数据。相信大家已经发现了，SPA 初始化时候，不得不等待 bundle 返回并执行后，才会发起数据加载。</p>
<p>如下示例代码：</p>
<pre><code>// app.js
Promise.all([load(&apos;bundle&apos;), load(&apos;data&apos;)])
</code></pre><h3 id="2-根据路由拆分-——-减少初始加载体积"><a href="#2-根据路由拆分-——-减少初始加载体积" class="headerlink" title="2. 根据路由拆分 —— 减少初始加载体积"></a>2. 根据路由拆分 —— 减少初始加载体积</h3><p>利用异步加载方式，在路由注册时提供异步拉取组件的方法，仅在需要进入对应路由时，对应组件才会被加载进来。</p>
<pre><code>route({
  Home: () =&gt; import(&apos;@/coms/home&apos;),
  About: () =&gt; import(&apos;@/coms/about&apos;)
})
</code></pre><h3 id="3-独立打包异步组件公共-Bundle-——-提高复用性-amp-缓存命中率"><a href="#3-独立打包异步组件公共-Bundle-——-提高复用性-amp-缓存命中率" class="headerlink" title="3. 独立打包异步组件公共 Bundle —— 提高复用性&amp;缓存命中率"></a>3. 独立打包异步组件公共 Bundle —— 提高复用性&amp;缓存命中率</h3><p>在Home和About等路由里面 ，可能公用一套 UI 组件， 若不将异步加载公用 组件统一打包，每次加载 路由时，都会额外加载一套 UI 组件。通过将公用组件提取打包成Vendor，可以减少下次进入路由加载体积与时间。</p>
<p>BTW：在<code>webpack &lt; 4</code>时，依旧需要手动维护异步加载组件公用组件。<code>webpack4</code>提供更丰富的异步组件抽离方案。</p>
<h3 id="4-组件预加载-——-减少页面切换时间"><a href="#4-组件预加载-——-减少页面切换时间" class="headerlink" title="4. 组件预加载 —— 减少页面切换时间"></a>4. 组件预加载 —— 减少页面切换时间</h3><p>当首屏加载完毕后，设备&amp;网络处于空闲状态，可以 对其他路由组件进行预加载，以便提升页面切换性能。</p>
<p>预加载是一个非常繁琐的过程，我们可以设计一个极小启动器，在页面渲染后快速预加载后续组件：</p>
<pre><code>// 所有包含Page的路由组件均会被预加载
boostraper.loadMatch(&apos;Page&apos;)
</code></pre><h3 id="5-使用-ESM-语法-——-按需打包工具库，降低-Bundle-体积"><a href="#5-使用-ESM-语法-——-按需打包工具库，降低-Bundle-体积" class="headerlink" title="5. 使用 ESM 语法 —— 按需打包工具库，降低 Bundle 体积"></a>5. 使用 ESM 语法 —— 按需打包工具库，降低 Bundle 体积</h3><p><code>webpack4</code>在 ESM <code>tree shaking</code>上做了极大优化，使得在引用工具库时候真正做到”按需打包”，这要求无论是自己开发的工具库，抑或使用第三方工具库，打包&amp;使用 ESM 版本非常必要。</p>
<h3 id="6-配合-PWA-使用，口感更佳-——-降低首屏渲染时间，极大提升体验"><a href="#6-配合-PWA-使用，口感更佳-——-降低首屏渲染时间，极大提升体验" class="headerlink" title="6. 配合 PWA 使用，口感更佳 —— 降低首屏渲染时间，极大提升体验"></a>6. 配合 PWA 使用，口感更佳 —— 降低首屏渲染时间，极大提升体验</h3><p>根据 PWA 缓存策略，可以将访问的页面index.html缓存起来，下次打开时候优先利用缓存，再发起请求更新缓存。这使得 SPA 应用几乎不需要额外时间便可加载应用首屏文档流。</p>
<h2 id="体验优化"><a href="#体验优化" class="headerlink" title="体验优化"></a>体验优化</h2><h3 id="1-构建你的极简Skeleton-Page"><a href="#1-构建你的极简Skeleton-Page" class="headerlink" title="1. 构建你的极简Skeleton Page"></a>1. 构建你的极简Skeleton Page</h3><p>SPA 首屏加载面临较长时间白屏，骨架图是一个完美的”缓兵之计”。在谷歌研究员的文章 中有提到，骨架图对用户体验有极大的提升：</p>
<ul>
<li><p>快速展示</p>
<ul>
<li>配合 PWA 首屏缓存，骨架图可实现瞬间加载&amp;展示，首屏视觉上有冲击性地提升</li>
</ul>
</li>
<li><p>稳定加载</p>
<ul>
<li>消除页面初始加载因多次重绘&amp;资源加载导致的”抖动”</li>
</ul>
</li>
</ul>
<p>需要注意的是，骨架图应尽量保持足够小巧与简单，以确保不会严重影响页面后续加载。</p>
<h3 id="2-页面切换-Loading"><a href="#2-页面切换-Loading" class="headerlink" title="2.页面切换 Loading"></a>2.页面切换 Loading</h3><p>无论如何优化性能加载，在页面切换时候依旧需要获取页面数据，若处理不好，可能会在数据返回前有短暂的不友好”空白”。通过以下方式可以很好处理这个问题：</p>
<ul>
<li><p>友好的切换前 Loading</p>
<ul>
<li>在确保组件&amp;数据加载完毕前，可保证页面可交互性，减少用户阻塞感</li>
</ul>
</li>
<li><p>转场动画</p>
<ul>
<li><p>在大多数原生应用，转场动画属于标配</p>
</li>
<li><p>即时组件&amp;数据已经完全加载，在切换至新页面瞬间，依旧需要页面渲染时间，这段时间可能导致页面短暂空白或者”视觉阻塞”</p>
</li>
<li><p>通过转场动画时间，可以很好地缓解这个问题，大多数页面保证在转场动画完毕之后依然渲染完毕</p>
</li>
</ul>
</li>
<li><p>最后</p>
</li>
</ul>
<p>除了上述提到的 SPA 优化方案，Web 性能基础也是必备的基础（如域名收敛、合理文档结构）。性能优化本质是一个页面精细化监控运营的过程，也要求我们对 Web 加载的过程与逻辑有更多的思考与理解。</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
    <hr />
    <h3>留言:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://www.facebook.com/profile.php?id=100019094295164" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://github.com/Hubylida" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2018 Yuan<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'Yuan';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>